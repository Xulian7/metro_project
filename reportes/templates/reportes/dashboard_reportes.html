{% extends "accounts/home.html" %}
{% load humanize %}

{% block content %}
<div class="card p-4 shadow-sm">

  <!-- ================= HEADER ================= -->
  <h4 class="fw-bold mb-2">
    Reportes operativos
  </h4>

  <p class="text-muted mb-4">
    Periodo:
    <strong>{{ inicio }}</strong> →
    <strong>{{ fin }}</strong>
  </p>

  <!-- ================= FILTRO FECHAS ================= -->
  <form method="get" class="row g-2 mb-4 align-items-end">

    <div class="col-md-3">
      <label class="form-label small">Desde</label>
      <input type="date"
             name="inicio"
             value="{{ inicio }}"
             class="form-control form-control-sm">
    </div>

    <div class="col-md-3">
      <label class="form-label small">Hasta</label>
      <input type="date"
             name="fin"
             value="{{ fin }}"
             class="form-control form-control-sm">
    </div>

    <div class="col-md-3">
      <button class="btn btn-sm btn-primary">
        Aplicar
      </button>
    </div>

  </form>

  <!-- ================= TABS ================= -->
  <ul class="nav nav-tabs mb-3" role="tablist">

    <li class="nav-item">
      <button class="nav-link active"
              data-bs-toggle="tab"
              data-bs-target="#tab-items">
        Ítems (resumen)
      </button>
    </li>

    <li class="nav-item">
      <button class="nav-link"
              data-bs-toggle="tab"
              data-bs-target="#tab-pagos">
        Medios de pago
      </button>
    </li>

    <li class="nav-item">
      <button class="nav-link"
              data-bs-toggle="tab"
              data-bs-target="#tab-cuentas">
        Cuentas
      </button>
    </li>

    <li class="nav-item">
      <button class="nav-link"
              data-bs-toggle="tab"
              data-bs-target="#tab-multas">
        Multas
      </button>
    </li>

    <li class="nav-item">
      <button class="nav-link"
              data-bs-toggle="tab"
              data-bs-target="#tab-detalle-items">
        Almacén & Taller
      </button>
    </li>

  </ul>

  <!-- ================= CONTENIDO TABS ================= -->
  <div class="tab-content">

    <!-- ===== TAB ITEMS RESUMEN ===== -->
    <div class="tab-pane fade show active" id="tab-items">
      <div class="table-responsive">
        <table class="table table-sm table-striped">
          <thead class="table-light">
            <tr>
              <th>Tipo de ítem</th>
              <th class="text-center">Cantidad</th>
              <th class="text-end">Total</th>
            </tr>
          </thead>
          <tbody>
            {% for i in items %}
            <tr>
              <td>{{ i.tipo_item|capfirst }}</td>
              <td class="text-center">{{ i.cantidad }}</td>
              <td class="text-end">
                ${{ i.total|intcomma }}
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="3" class="text-center text-muted">
                Sin datos en el periodo
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <!-- ===== TAB PAGOS ===== -->
    <div class="tab-pane fade" id="tab-pagos">
      <div class="table-responsive">
        <table class="table table-sm table-striped">
          <thead class="table-light">
            <tr>
              <th>Medio de pago</th>
              <th class="text-end">Total</th>
            </tr>
          </thead>
          <tbody>
            {% for p in pagos %}
            <tr>
              <td>{{ p.configuracion__medio__nombre }}</td>
              <td class="text-end">
                ${{ p.total|intcomma }}
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="2" class="text-center text-muted">
                Sin movimientos
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <!-- ===== TAB CUENTAS ===== -->
    <div class="tab-pane fade" id="tab-cuentas">
      <div class="table-responsive">
        <table class="table table-sm table-striped">
          <thead class="table-light">
            <tr>
              <th>Cuenta destino</th>
              <th class="text-end">Total</th>
            </tr>
          </thead>
          <tbody>
            {% for c in cuentas %}
            <tr>
              <td>{{ c.configuracion__cuenta_destino__nombre }}</td>
              <td class="text-end">
                ${{ c.total|intcomma }}
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="2" class="text-center text-muted">
                Sin datos
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <!-- ===== TAB MULTAS DETALLADAS ===== -->
    <div class="tab-pane fade" id="tab-multas">
      <div class="table-responsive">
        <table class="table table-sm table-striped">
          <thead class="table-light">
            <tr>
              <th>Fecha</th>
              <th>Contrato</th>
              <th>Descripción</th>
              <th class="text-end">Valor</th>
            </tr>
          </thead>
          <tbody>
            {% for m in multas %}
            <tr>
              <td>{{ m.factura__fecha|date:"d/m/Y" }}</td>
              <td>#{{ m.factura__contrato__id }}</td>
              <td>{{ m.descripcion }}</td>
              <td class="text-end">
                ${{ m.subtotal|intcomma }}
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="4" class="text-center text-muted">
                No hay multas en el periodo
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <!-- ===== TAB ALMACÉN & TALLER DETALLADO ===== -->
    <div class="tab-pane fade" id="tab-detalle-items">
      <div class="table-responsive">
        <table class="table table-sm table-striped">
          <thead class="table-light">
            <tr>
              <th>Fecha</th>
              <th>Tipo</th>
              <th>Descripción</th>
              <th class="text-center">Cant.</th>
              <th class="text-end">Subtotal</th>
            </tr>
          </thead>
          <tbody>
            {% for d in detalle_items %}
            <tr>
              <td>{{ d.factura__fecha|date:"d/m/Y" }}</td>
              <td>{{ d.tipo_item|capfirst }}</td>
              <td>{{ d.descripcion }}</td>
              <td class="text-center">{{ d.cantidad }}</td>
              <td class="text-end">
                ${{ d.subtotal|intcomma }}
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="5" class="text-center text-muted">
                Sin movimientos
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

  </div>

</div>
{% endblock %}
