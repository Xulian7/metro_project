{% extends "accounts/home.html" %}
{% load widget_tweaks %}
{% load static %}

{% block content %}

<h5 class="mb-3">Administración de medios de pago</h5>

<ul class="nav nav-tabs mb-3" id="catalogosTabs" role="tablist">

  <li class="nav-item" role="presentation">
    <button class="nav-link active"
            data-bs-toggle="tab"
            data-bs-target="#cuentas"
            type="button">
      Cuentas
    </button>
  </li>

  <li class="nav-item" role="presentation">
    <button class="nav-link"
            data-bs-toggle="tab"
            data-bs-target="#origenes"
            type="button">
      Orígenes
    </button>
  </li>

  <li class="nav-item" role="presentation">
    <button class="nav-link"
            data-bs-toggle="tab"
            data-bs-target="#canales"
            type="button">
      Canales
    </button>
  </li>

  <li class="nav-item" role="presentation">
    <button class="nav-link"
            data-bs-toggle="tab"
            data-bs-target="#configuracion"
            type="button">
      Configuración
    </button>
  </li>

</ul>

<div class="tab-content">

  <!-- ================= CUENTAS ================= -->
  <div class="tab-pane fade show active" id="cuentas">

    <form method="post" class="card card-body mb-4">
      {% csrf_token %}
      {{ cuenta_form.non_field_errors }}

      <div class="mb-3">
        <label class="form-label">Nombre</label>
        {{ cuenta_form.nombre|add_class:"form-control" }}
      </div>

      <div class="form-check mb-3">
        {{ cuenta_form.activa|add_class:"form-check-input" }}
        <label class="form-check-label">Activa</label>
      </div>

      <button class="btn btn-primary btn-sm" name="guardar_cuenta">
        Guardar cuenta
      </button>
    </form>

    <table class="table table-sm table-hover">
      <thead class="table-light">
        <tr>
          <th>Nombre</th>
          <th>Activa</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        {% for c in cuentas %}
        <tr>
          <td>{{ c.nombre }}</td>
          <td>{{ c.activa|yesno:"Sí,No" }}</td>
          <td class="text-end">
            <a href="?cuenta={{ c.id }}" class="btn btn-outline-primary btn-sm">
              Editar
            </a>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="3" class="text-muted text-center">
            No hay cuentas registradas
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

  </div>

  <!-- ================= ORÍGENES ================= -->
  <div class="tab-pane fade" id="origenes">

    <form method="post" class="card card-body mb-4">
      {% csrf_token %}
      {{ origen_form.non_field_errors }}

      {% for field in origen_form %}
        <div class="mb-3">
          <label class="form-label">{{ field.label }}</label>
          {{ field|add_class:"form-control" }}
        </div>
      {% endfor %}

      <button class="btn btn-primary btn-sm" name="guardar_origen">
        Guardar origen
      </button>
    </form>

    <table class="table table-sm table-hover">
      <thead class="table-light">
        <tr>
          <th>Nombre</th>
          <th>Tipo</th>
          <th>Activo</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        {% for o in origenes %}
        <tr>
          <td>{{ o.nombre }}</td>
          <td>{{ o.get_tipo_display }}</td>
          <td>{{ o.activo|yesno:"Sí,No" }}</td>
          <td class="text-end">
            <a href="?origen={{ o.id }}#origenes"
               class="btn btn-outline-primary btn-sm">
              Editar
            </a>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="4" class="text-muted text-center">
            No hay orígenes registrados
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

  </div>

  <!-- ================= CANALES ================= -->
  <div class="tab-pane fade" id="canales">

    <form method="post" class="card card-body mb-4">
      {% csrf_token %}
      {{ canal_form.non_field_errors }}

      {% for field in canal_form %}
        <div class="mb-3">
          <label class="form-label">{{ field.label }}</label>

          {% if field.field.widget.input_type == "checkbox" %}
            <div class="form-check">
              {{ field|add_class:"form-check-input" }}
            </div>
          {% else %}
            {{ field|add_class:"form-control" }}
          {% endif %}
        </div>
      {% endfor %}

      <button class="btn btn-primary btn-sm" name="guardar_canal">
        Guardar canal
      </button>
    </form>

    <table class="table table-sm table-hover">
      <thead class="table-light">
        <tr>
          <th>Código</th>
          <th>Nombre</th>
          <th>Activo</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        {% for c in canales %}
        <tr>
          <td>{{ c.codigo }}</td>
          <td>{{ c.nombre }}</td>
          <td>{{ c.activo|yesno:"Sí,No" }}</td>
          <td class="text-end">
            <a href="?canal={{ c.id }}#canales"
               class="btn btn-outline-primary btn-sm">
              Editar
            </a>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="4" class="text-muted text-center">
            No hay canales registrados
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

  </div>

  <!-- ================= CONFIGURACIÓN ================= -->
  <div class="tab-pane fade" id="configuracion">

    <form method="post" class="card card-body mb-4">
      {% csrf_token %}
      {{ config_form.non_field_errors }}

      {% for field in config_form %}
        <div class="mb-3">
          <label class="form-label">{{ field.label }}</label>
          {{ field|add_class:"form-control" }}
        </div>
      {% endfor %}

      <button class="btn btn-primary btn-sm" name="guardar_config">
        Guardar configuración
      </button>
    </form>

    <table class="table table-sm table-hover">
      <thead class="table-light">
        <tr>
          <th>Origen</th>
          <th>Canal</th>
          <th>Débito</th>
          <th>Crédito</th>
          <th>Activo</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        {% for c in configuraciones %}
        <tr>
          <td>{{ c.origen.nombre }}</td>
          <td>{{ c.canal.nombre }}</td>
          <td>{{ c.cuenta_debito }}</td>
          <td>{{ c.cuenta_credito }}</td>
          <td>{{ c.activo|yesno:"Sí,No" }}</td>
          <td class="text-end">
            <a href="?config={{ c.id }}#configuracion"
               class="btn btn-outline-primary btn-sm">
              Editar
            </a>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="6" class="text-muted text-center">
            No hay configuraciones registradas
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

  </div>

</div>

{% endblock %}
