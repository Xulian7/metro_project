{% extends "accounts/home.html" %}
{% load widget_tweaks %}

{% block content %}

<h5 class="mb-3">Administración de medios de pago</h5>

<ul class="nav nav-tabs mb-3">

  <li class="nav-item">
    <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#medios">
      Medios de pago
    </button>
  </li>

  <li class="nav-item">
    <button class="nav-link" data-bs-toggle="tab" data-bs-target="#canales">
      Canales
    </button>
  </li>

  <li class="nav-item">
    <button class="nav-link" data-bs-toggle="tab" data-bs-target="#cuentas">
      Cuentas destino
    </button>
  </li>

  <li class="nav-item">
    <button class="nav-link" data-bs-toggle="tab" data-bs-target="#configuracion">
      Configuración (Medio → Cuenta)
    </button>
  </li>

</ul>

<div class="tab-content">

  <!-- ================= MEDIOS DE PAGO ================= -->
  <div class="tab-pane fade show active" id="medios">

    <form method="post" class="card card-body mb-4">
      {% csrf_token %}
      {{ medio_form.non_field_errors }}

      <div class="mb-3">
        <label class="form-label">Nombre del medio</label>
        {{ medio_form.nombre|add_class:"form-control" }}
      </div>

      <div class="form-check mb-3">
        {{ medio_form.activo|add_class:"form-check-input" }}
        <label class="form-check-label">Activo</label>
      </div>

      <button class="btn btn-primary btn-sm" name="guardar_medio">
        Guardar medio
      </button>
    </form>

    <table class="table table-sm table-hover">
      <thead class="table-light">
        <tr>
          <th>Medio</th>
          <th>Activo</th>
        </tr>
      </thead>
      <tbody>
        {% for m in medios %}
        <tr>
          <td>{{ m.nombre }}</td>
          <td>{{ m.activo|yesno:"Sí,No" }}</td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="2" class="text-muted text-center">
            No hay medios registrados
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

  </div>

  <!-- ================= CANALES ================= -->
  <div class="tab-pane fade" id="canales">

    <form method="post" class="card card-body mb-4">
      {% csrf_token %}
      {{ canal_form.non_field_errors }}

      <div class="mb-3">
        <label class="form-label">Medio de pago</label>
        {{ canal_form.medio|add_class:"form-control" }}
      </div>

      <div class="mb-3">
        <label class="form-label">Nombre del canal</label>
        {{ canal_form.nombre|add_class:"form-control" }}
      </div>

      <div class="form-check mb-3">
        {{ canal_form.requiere_referencia|add_class:"form-check-input" }}
        <label class="form-check-label">Requiere referencia</label>
      </div>

      <div class="form-check mb-3">
        {{ canal_form.activo|add_class:"form-check-input" }}
        <label class="form-check-label">Activo</label>
      </div>

      <button class="btn btn-primary btn-sm" name="guardar_canal">
        Guardar canal
      </button>
    </form>

    <table class="table table-sm table-hover">
      <thead class="table-light">
        <tr>
          <th>Medio</th>
          <th>Canal</th>
          <th>Activo</th>
        </tr>
      </thead>
      <tbody>
        {% for c in canales %}
        <tr>
          <td>{{ c.medio.nombre }}</td>
          <td>{{ c.nombre }}</td>
          <td>{{ c.activo|yesno:"Sí,No" }}</td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="3" class="text-muted text-center">
            No hay canales registrados
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

  </div>

  <!-- ================= CUENTAS DESTINO ================= -->
  <div class="tab-pane fade" id="cuentas">

    <form method="post" class="card card-body mb-4">
      {% csrf_token %}
      {{ cuenta_form.non_field_errors }}

      <div class="mb-3">
        <label class="form-label">Nombre de la cuenta</label>
        {{ cuenta_form.nombre|add_class:"form-control" }}
      </div>

      <div class="form-check mb-3">
        {{ cuenta_form.activa|add_class:"form-check-input" }}
        <label class="form-check-label">Activa</label>
      </div>

      <button class="btn btn-primary btn-sm" name="guardar_cuenta">
        Guardar cuenta
      </button>
    </form>

    <table class="table table-sm table-hover">
      <thead class="table-light">
        <tr>
          <th>Cuenta</th>
          <th>Activa</th>
        </tr>
      </thead>
      <tbody>
        {% for c in cuentas %}
        <tr>
          <td>{{ c.nombre }}</td>
          <td>{{ c.activa|yesno:"Sí,No" }}</td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="2" class="text-muted text-center">
            No hay cuentas registradas
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

  </div>

  <!-- ================= CONFIGURACIÓN ================= -->
  <div class="tab-pane fade" id="configuracion">

    <form method="post" class="card card-body mb-4">
      {% csrf_token %}
      {{ config_form.non_field_errors }}

      <div class="mb-3">
        <label class="form-label">Medio de pago</label>
        {{ config_form.canal.medio|add_class:"form-control" }}
      </div>

      <div class="mb-3">
        <label class="form-label">Cuenta destino</label>
        {{ config_form.cuenta_destino|add_class:"form-control" }}
      </div>

      <div class="form-check mb-3">
        {{ config_form.activo|add_class:"form-check-input" }}
        <label class="form-check-label">Activo</label>
      </div>

      <button class="btn btn-primary btn-sm" name="guardar_config">
        Asociar cuenta al medio
      </button>
    </form>

    <table class="table table-sm table-hover">
      <thead class="table-light">
        <tr>
          <th>Medio</th>
          <th>Cuenta destino</th>
          <th>Activo</th>
        </tr>
      </thead>
      <tbody>
        {% for c in configuraciones %}
        <tr>
          <td>{{ c.canal.medio.nombre }}</td>
          <td>{{ c.cuenta_destino.nombre }}</td>
          <td>{{ c.activo|yesno:"Sí,No" }}</td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="3" class="text-muted text-center">
            No hay configuraciones creadas
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

  </div>

</div>

{% endblock %}
