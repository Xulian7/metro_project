{% extends "accounts/home.html" %}
{% load static %}

{% block content %}
<div class="card p-4 shadow-sm">

  <h3 class="fw-bold mb-4">Contratos</h3>

  <!-- üßæ Formulario para crear contrato -->
  <form method="post" class="row g-3 mb-4">
    {% csrf_token %}

    <div class="col-md-4">
      <label class="form-label">Cliente</label>
      {{ form.cliente }}
    </div>

    <div class="col-md-4">
      <label class="form-label">Veh√≠culo</label>
      {{ form.vehiculo }}
    </div>

    <div class="col-md-2">
      <label class="form-label">Fecha inicio</label>
      {{ form.fecha_inicio }}
    </div>

    <div class="col-md-2">
      <label class="form-label">Cuota inicial</label>
      {{ form.cuota_inicial }}
    </div>

    <div class="col-md-2">
      <label class="form-label">Tarifa</label>
      {{ form.tarifa }}
    </div>

    <div class="col-md-2">
      <label class="form-label">D√≠as contrato</label>
      {{ form.dias_contrato }}
    </div>

    <div class="col-md-3">
      <label class="form-label">Visitador</label>
      {{ form.visitador }}
    </div>

    <div class="col-12 text-end mt-4">
      <button type="submit" class="btn btn-primary px-4">Guardar Contrato</button>
    </div>
  </form>

  <!-- üîç Filtro din√°mico -->
  <div class="mb-3">
    <input type="text" id="filtroTabla" class="form-control" placeholder="Filtrar contratos..." />
  </div>

  <!-- üìã Tabla de contratos -->
  <table class="table modern-table mt-3" id="tablaContratos">
    <thead>
      <tr>
        <th>Cliente</th>
        <th>Veh√≠culo</th>
        <th>Fecha inicio</th>
        <th>Tarifa</th>
        <th>D√≠as</th>
        <th>Visitador</th>
        <th>Estado</th>
      </tr>
    </thead>
    <tbody>
      {% for c in contratos %}
      <tr>
        <td>{{ c.cliente }}</td>
        <td>{{ c.vehiculo }}</td>
        <td>{{ c.fecha_inicio }}</td>
        <td>{{ c.tarifa }}</td>
        <td>{{ c.dias_contrato }}</td>
        <td>{{ c.visitador }}</td>
        <td>{{ c.estado }}</td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="7" class="text-center">Sin contratos registrados</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

</div>

<!-- üé® Estilos -->
<style>
  .modern-table {
    border-collapse: separate;
    border-spacing: 0 0.4rem;
    font-size: 0.9rem;
  }

  .modern-table thead {
    background: linear-gradient(90deg, #1e3c72, #2a5298);
    color: white;
  }

  .modern-table tbody tr {
    background: #fff;
    transition: all 0.2s ease;
  }

  .modern-table tbody tr:hover {
    background: #f3f6ff;
    transform: scale(1.01);
  }

  #filtroTabla {
    border: 2px solid #2a5298;
    border-radius: 8px;
    padding: 0.5rem 1rem;
  }

  #filtroTabla:focus {
    outline: none;
    box-shadow: 0 0 0 0.2rem rgba(42, 82, 152, 0.25);
  }
</style>

<!-- üß† Script: filtro din√°mico y Select2 -->
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0/dist/js/select2.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0/dist/css/select2.min.css" rel="stylesheet" />

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Inicializa Select2 si hay campos con esa clase
  $('.select2').select2({
    width: '100%',
    placeholder: 'Buscar...',
    allowClear: true
  });

  // üîç Filtro din√°mico nativo
  const input = document.getElementById("filtroTabla");
  const tabla = document.getElementById("tablaContratos").getElementsByTagName("tbody")[0];

  input.addEventListener("keyup", () => {
    const filtro = input.value.toLowerCase().trim();
    const filas = tabla.getElementsByTagName("tr");

    for (let fila of filas) {
      const textoFila = fila.textContent.toLowerCase();
      fila.style.display = textoFila.includes(filtro) ? "" : "none";
    }
  });
});
</script>
{% endblock %}
